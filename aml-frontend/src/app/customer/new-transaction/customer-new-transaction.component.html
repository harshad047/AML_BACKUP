<div class="container py-3">
  <h3 class="mb-3">New Transaction</h3>

  <form [formGroup]="form" (ngSubmit)="onSubmit()" class="card p-3">
    <div class="row g-3">
      <div class="col-md-4">
        <label class="form-label">Type</label>
        <select class="form-select" formControlName="type">
          <option value="DEPOSIT">Deposit</option>
          <option value="WITHDRAWAL">Withdrawal</option>
          <option value="TRANSFER">Transfer</option>
        </select>
      </div>
      <div class="col-md-4">
        <label class="form-label">Amount</label>
        <input type="number" class="form-control" formControlName="amount" min="0" step="0.01" />
      </div>
      <!-- Currency auto-detected from account by backend -->
      <!-- Account identifiers per type -->
      <div class="col-md-6" *ngIf="form.value.type === 'DEPOSIT'">
        <label class="form-label">To Account</label>
        <select class="form-select" formControlName="toAccountNumber">
          <option [ngValue]="''" disabled>Select account</option>
          <option *ngFor="let acc of activeAccounts" [ngValue]="acc.accountNumber">
            {{ acc.accountNumber }} — {{ acc.accountType }} ({{ acc.currency }})
          </option>
        </select>
        <small class="text-muted" *ngIf="activeAccounts.length === 0">
          No active accounts available. Please ensure your account is approved and active.
        </small>
      </div>
      <div class="col-md-6" *ngIf="form.value.type === 'WITHDRAWAL'">
        <label class="form-label">From Account</label>
        <select class="form-select" formControlName="fromAccountNumber">
          <option [ngValue]="''" disabled>Select account</option>
          <option *ngFor="let acc of activeAccounts" [ngValue]="acc.accountNumber">
            {{ acc.accountNumber }} — {{ acc.accountType }} ({{ acc.currency }})
          </option>
        </select>
        <small class="text-muted" *ngIf="activeAccounts.length === 0">
          No active accounts available. Please ensure your account is approved and active.
        </small>
      </div>
      <div class="col-md-6" *ngIf="form.value.type === 'TRANSFER'">
        <label class="form-label">From Account</label>
        <select class="form-select" formControlName="fromAccountNumber">
          <option [ngValue]="''" disabled>Select account</option>
          <option *ngFor="let acc of activeAccounts" [ngValue]="acc.accountNumber">
            {{ acc.accountNumber }} — {{ acc.accountType }} ({{ acc.currency }})
          </option>
        </select>
        <small class="text-muted" *ngIf="activeAccounts.length === 0">
          No active accounts available. Please ensure your account is approved and active.
        </small>
      </div>
      <div class="col-md-6" *ngIf="form.value.type === 'TRANSFER'">
        <label class="form-label">To Account Number</label>
        <input type="text" class="form-control" formControlName="toAccountNumber" placeholder="e.g. ACC987" />
      </div>
      <div class="col-md-12">
        <label class="form-label">Description (optional)</label>
        <input type="text" class="form-control" formControlName="description" />
      </div>
    </div>

    <div class="mt-3 d-flex gap-2 align-items-center">
      <button class="btn btn-primary" type="submit" [disabled]="form.invalid || loading">
        {{ loading ? 'Submitting...' : 'Submit' }}
      </button>
      <div *ngIf="error" class="text-danger">{{ error }}</div>
      <div *ngIf="success" class="text-success">Transaction submitted!</div>
    </div>
  </form>

  <div *ngIf="created" class="card p-3 mt-3">
    <h5 class="mb-2">Created Transaction</h5>
    <div>Transaction Type: {{ created.transactionType }}</div>
    <div>Amount: {{ created.amount }}</div>
    <div>Status: {{ created.status }}</div>
    <div>Date: {{ created.createdAt }}</div>
  </div>
</div>
