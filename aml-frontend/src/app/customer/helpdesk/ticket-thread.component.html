<div class="container py-3">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3 class="mb-0">Ticket Thread</h3>
    <a class="btn btn-secondary" routerLink="/customer/helpdesk">Back to My Tickets</a>
  </div>

  <div class="card">
    <div class="card-body" *ngIf="loading">Loading...</div>
    <div class="card-body text-danger" *ngIf="!loading && error">{{ error }}</div>
    <div class="list-group list-group-flush" *ngIf="!loading && messages.length > 0">
      <div class="list-group-item" *ngFor="let m of messages">
        <div class="d-flex justify-content-between">
          <div><span class="badge bg-secondary">{{ m.senderType }}</span></div>
          <div class="text-muted small">{{ m.createdAt | date:'short' }}</div>
        </div>
        <div class="mt-2">{{ m.content }}</div>
      </div>
    </div>
    <div class="card-body text-center text-muted" *ngIf="!loading && messages.length === 0">No messages yet.</div>
  </div>

  <div class="d-flex justify-content-between align-items-center mt-3">
    <button class="btn btn-outline-secondary" [disabled]="pageIndex===0" (click)="onPageChange(-1)">Prev</button>
    <div>Page {{ pageIndex + 1 }} of {{ Math.max(1, Math.ceil(total / pageSize)) }}</div>
    <button class="btn btn-outline-secondary" [disabled]="(pageIndex+1)*pageSize >= total" (click)="onPageChange(1)">Next</button>
  </div>

  <div class="card mt-3">
    <div class="card-body">
      <div class="mb-2">
        <textarea class="form-control" rows="3" [(ngModel)]="newMessage" placeholder="Type your message..."></textarea>
      </div>
      <button class="btn btn-primary" (click)="send()">Send</button>
    </div>
  </div>
</div>
