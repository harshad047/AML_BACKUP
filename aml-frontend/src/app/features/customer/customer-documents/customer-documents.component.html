<div class="container py-3">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3 class="mb-0">My Documents</h3>
    <span class="badge" [ngClass]="getOverallStatusClass()">
      {{ getOverallStatusText() }}
    </span>
  </div>

  <!-- Document Upload Section -->
  <div class="upload-card mb-4" [class.disabled]="isUploadDisabled()">
    <div class="upload-header" (click)="toggleUploadForm()" [style.cursor]="isUploadDisabled() ? 'pointer' : 'pointer'">
      <div class="d-flex align-items-center justify-content-between">
        <div class="d-flex align-items-center">
          <div class="upload-icon-wrapper me-3">
            <i class="fas" [ngClass]="isUploadDisabled() ? 'fa-lock' : 'fa-cloud-upload-alt'"></i>
          </div>
          <div>
            <h5 class="mb-0">Upload New Document</h5>
            <p class="text-muted small mb-0" *ngIf="!isUploadDisabled()">Upload your identity and verification documents</p>
            <p class="text-warning small mb-0" *ngIf="isUploadDisabled()">
              <i class="fas fa-exclamation-triangle me-1"></i>Click to view details
            </p>
          </div>
        </div>
        <div class="toggle-arrow" [class.expanded]="isUploadFormExpanded" *ngIf="!isUploadDisabled()">
          <i class="fas fa-chevron-down"></i>
        </div>
        <div *ngIf="isUploadDisabled()">
          <i class="fas fa-info-circle text-warning" style="font-size: 1.5rem;"></i>
        </div>
      </div>
    </div>
    <div class="upload-body" *ngIf="isUploadFormExpanded && !isUploadDisabled()" [@slideDown]>
      <form [formGroup]="uploadForm" (ngSubmit)="onUpload()">
        <!-- Document Type Selection -->
        <div class="document-type-section mb-4">
          <label class="form-label fw-semibold">
            <i class="fas fa-file-alt me-2"></i>Document Type
          </label>
          <select class="form-select modern-select" formControlName="documentType">
            <option value="">Select document type</option>
            <option value="AADHAAR">ü™™ Aadhaar Card</option>
            <option value="PAN">üí≥ PAN Card</option>
            <option value="PASSPORT">üõÇ Passport</option>
            <option value="DRIVING_LICENSE">üöó Driving License</option>
            <option value="VOTER_ID">üó≥Ô∏è Voter ID</option>
            <option value="BANK_STATEMENT">üè¶ Bank Statement</option>
            <option value="UTILITY_BILL">üìÑ Utility Bill</option>
            <option value="OTHER">üìé Other</option>
          </select>
          <div *ngIf="uploadForm.get('documentType')?.invalid && uploadForm.get('documentType')?.touched" class="error-message">
            <i class="fas fa-exclamation-circle me-1"></i>Document type is required
          </div>
        </div>

        <!-- File Upload Area -->
        <div class="file-upload-section mb-4">
          <label class="form-label fw-semibold">
            <i class="fas fa-paperclip me-2"></i>Choose File
          </label>
          <div class="upload-zone" 
               [class.has-file]="selectedFileName"
               [class.drag-over]="isDragOver"
               (dragover)="onDragOver($event)"
               (dragleave)="onDragLeave($event)"
               (drop)="onDrop($event)"
               (click)="fileInput.click()">
            <input type="file" 
                   class="d-none" 
                   #fileInput 
                   (change)="onFileSelected($event)" 
                   accept=".pdf,.jpg,.jpeg,.png" />
            
            <div *ngIf="!selectedFileName" class="upload-placeholder">
              <div class="upload-icon">
                <i class="fas fa-cloud-upload-alt"></i>
              </div>
              <h6 class="mt-3 mb-2">Drag & drop your file here</h6>
              <p class="text-muted mb-2">or</p>
              <button type="button" class="btn btn-outline-primary btn-sm">
                <i class="fas fa-folder-open me-2"></i>Browse Files
              </button>
              <p class="file-info mt-3">
                <i class="fas fa-info-circle me-1"></i>
                Supported: PDF, JPG, PNG ‚Ä¢ Max size: 5MB
              </p>
            </div>

            <div *ngIf="selectedFileName" class="file-preview">
              <div class="file-icon">
                <i class="fas" [ngClass]="getFileIcon()"></i>
              </div>
              <div class="file-details">
                <h6 class="mb-1">{{ selectedFileName }}</h6>
                <p class="text-muted small mb-0">{{ getFileSize() }}</p>
              </div>
              <button type="button" 
                      class="btn btn-sm btn-outline-danger remove-file" 
                      (click)="removeFile($event)">
                <i class="fas fa-times"></i>
              </button>
            </div>
          </div>
          <div *ngIf="uploadError" class="error-message mt-2">
            <i class="fas fa-exclamation-triangle me-1"></i>{{ uploadError }}
          </div>
          <div *ngIf="uploadSuccess" class="success-message mt-2">
            <i class="fas fa-check-circle me-1"></i>{{ uploadSuccess }}
          </div>
        </div>

        <!-- Upload Button -->
        <div class="upload-actions">
          <button class="btn btn-primary btn-lg w-100" 
                  type="submit" 
                  [disabled]="!selectedFile || uploading || uploadForm.invalid || isUploadDisabled()">
            <span *ngIf="!uploading">
              <i class="fas fa-upload me-2"></i>Upload Document
            </span>
            <span *ngIf="uploading">
              <span class="spinner-border spinner-border-sm me-2" role="status"></span>
              Uploading...
            </span>
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- KYC Verification Status Tiles -->
  <div class="kyc-status-section mb-4" *ngIf="hasKycStatus()">
    <div class="section-header mb-3">
      <h5 class="mb-1">KYC Verification Status</h5>
      <p class="text-muted small mb-0">{{ getKycStatusMessage() }}</p>
    </div>
    
    <div class="row g-3">
      <!-- Uploaded Tile -->
      <div class="col-md-3 col-sm-6">
        <div class="status-tile uploaded-tile">
          <div class="tile-icon">
            <i class="fas fa-cloud-upload-alt"></i>
          </div>
          <div class="tile-content">
            <h3 class="tile-count">{{ getTotalDocumentsCount() }}</h3>
            <p class="tile-label">Uploaded</p>
          </div>
        </div>
      </div>

      <!-- Pending Tile -->
      <div class="col-md-3 col-sm-6">
        <div class="status-tile pending-tile">
          <div class="tile-icon">
            <i class="fas fa-clock"></i>
          </div>
          <div class="tile-content">
            <h3 class="tile-count">{{ getPendingDocumentsCount() }}</h3>
            <p class="tile-label">Pending</p>
          </div>
        </div>
      </div>

      <!-- Verified Tile -->
      <div class="col-md-3 col-sm-6">
        <div class="status-tile verified-tile">
          <div class="tile-icon">
            <i class="fas fa-check-circle"></i>
          </div>
          <div class="tile-content">
            <h3 class="tile-count">{{ getVerifiedDocumentsCount() }}</h3>
            <p class="tile-label">Verified</p>
          </div>
        </div>
      </div>

      <!-- Rejected Tile -->
      <div class="col-md-3 col-sm-6">
        <div class="status-tile rejected-tile">
          <div class="tile-icon">
            <i class="fas fa-times-circle"></i>
          </div>
          <div class="tile-content">
            <h3 class="tile-count">{{ getRejectedDocumentsCount() }}</h3>
            <p class="tile-label">Rejected</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="card-body p-0">
      <div class="text-center text-muted py-4" *ngIf="loading">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-2">Loading documents...</p>
      </div>

      <div class="alert alert-danger" *ngIf="error">{{ error }}</div>

      <div class="table-responsive" *ngIf="!loading && documents.length > 0">
        <table class="table table-striped mb-0">
          <thead class="table-light">
            <tr>
              <th>#</th>
              <th>Document Type</th>
              <th>File Name</th>
              <th>Status</th>
              <th>Verification</th>
              <th>Uploaded</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let doc of documents; index as i" [class]="'document-row ' + getDocumentRowClass(doc)">
              <td>{{ i + 1 }}</td>
              <td>
                <strong>{{ getDocumentTypeDisplay(doc) }}</strong>
                <div class="text-muted small">{{ getDocumentDescription(doc) }}</div>
              </td>
              <td>{{ getFileName(doc) }}</td>
              <td>
                <span class="badge" [ngClass]="getStatusBadgeClass(doc.status)">
                  {{ getStatusText(doc) }}
                </span>
              </td>
              <td>
                <span class="badge" [ngClass]="getVerificationBadgeClass(doc)">
                  {{ getVerificationText(doc) }}
                </span>
              </td>
              <td>{{ getUploadedDate(doc) | date:'medium' }}</td>
              <td>
                <button class="btn btn-sm btn-outline-primary" (click)="viewDocument(doc)" title="View Document">
                  <i class="fas fa-eye me-1"></i>View Document
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="text-center text-muted py-4" *ngIf="!loading && documents.length === 0">
        <i class="fas fa-file-alt fa-3x mb-3 text-muted"></i>
        <p>No documents found</p>
        <small class="text-muted">Documents uploaded during registration will appear here once processed.</small>
      </div>
    </div>
  </div>

  <!-- Upload Restriction Modal -->
  <app-upload-restriction-modal
    [isOpen]="showRestrictionModal"
    [documentType]="modalDocumentType"
    [status]="modalStatus"
    [restrictionType]="modalRestrictionType"
    (closeModal)="closeRestrictionModal()">
  </app-upload-restriction-modal>

  <!-- Document Preview Modal -->
  <app-document-preview-modal
    [isOpen]="showPreviewModal"
    [document]="previewDocument"
    (closeModal)="closePreviewModal()">
  </app-document-preview-modal>
</div>
